Добавление ТОРГ-2 в модуль
=======================================

Для создания акта об установленном расхождении ТОРГ-2 нужно выполнить следующие пункты:

1. Функция ПолучитьТаблицуИспользуемыхПакетов

Дополнить строкой:

::

    ДобавитьСтрокуТЗ(ТЗ, "ID_АктОРасхождениях", "Акт о расхождениях ТОРГ-2", "ID_АктОРасхождениях", АктОРасхождениях);

2. Функция ПолучитьТаблицуИспользуемыхВидовДокументов

Дополнить строкой:

::

    ДобавитьСтрокуТЗ(ТЗ, "ID_АктОРасхождениях", "Акт о расхождениях", "Torg2", "torg2", "NoAdditionalInfo");

3. Функция ПолучитьТекстЗапросаДляСпискаПакетовНаОтправкуПоМассивуВидовПакетов

Дополнить условием:

::

    ИначеЕсли	ВидПакетаID = "ID_АктОРасхождениях" Тогда
	Результат = ДобавитьОбъединениеВТекстЗапроса(Результат) + ТекстЗапроса_АктыОРасхождениях(ОписаниеВидаПакета);

4. Функция ПодготовитьПакет

Дополнить условием:

::

    ИначеЕсли ВидПакетаРазвернутый.ID = "ID_АктОРасхождениях" Тогда
	ОсновнойМодуль.ЭДО_ДокументМенеджер_ПодготовитьИДобавитьДокументВПакет(Пакет, Документ1С, "ID_АктОРасхождениях");

5. Функция ПодготовитьЭлектронныйДокумент

Дополнить условием:

::

    ИначеЕсли ID = "ID_АктОРасхождениях" Тогда
	Заполнить_Torg2SenderTitle(Результат.Content, Content);

6. Функция КатегорииПакетов

Дополнить структуру:

::

    Результат.Вставить("АктОРасхождениях", "АктОРасхождениях");

7. Функция НаименованиеКатегории

Дополнить структуру:

::

    Результат.Вставить("АктОРасхождениях", "Акт о расхождениях");

8. Добавить функцию ТекстЗапроса_АктыОРасхождениях(ОписаниеВидаПакета)

::

     Функция ТекстЗапроса_АктыОРасхождениях(ОписаниеВидаПакета)
	
	 ВидПакетаID = ОписаниеВидаПакета.ID;
	
	 Результат = 
	 "ВЫБРАТЬ
	 |	АктОРасхождениях.Ссылка КАК Документ,
	 |	АктОРасхождениях.Номер КАК НомерДокумента,
	 |	АктОРасхождениях.Дата КАК ДатаДокумента,
	 |	АктОРасхождениях.Контрагент КАК Контрагент,
	 |	АктОРасхождениях.Организация КАК Организация,
	 |	АктОРасхождениях.СуммаДокумента КАК СуммаДокумента,
 	 |	&ВидПакетаID КАК ВидПакетаID
	 |ИЗ
	 |	Документ.АктОРасхождениях КАК АктОРасхождениях
	 |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_КэшКонтрагентовПоВидамПакетов КАК ВТ_КэшКонтрагентовПоВидамПакетов
	 |		ПО АктОРасхождениях.Организация = ВТ_КэшКонтрагентовПоВидамПакетов.Организация1С
	 |			И АктОРасхождениях.Контрагент = ВТ_КэшКонтрагентовПоВидамПакетов.Контрагент1С
	 |			И (ВТ_КэшКонтрагентовПоВидамПакетов.ВидПакетаID = &ВидПакетаID)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтправленныеДокументы КАК ОтправленныеДокументы
	 |		ПО АктОРасхождениях.Ссылка = ОтправленныеДокументы.Документ
	 |			И (ОтправленныеДокументы.КатегорияПакета = &КатегорияПакета)
	 |ГДЕ
	 |	ОтправленныеДокументы.Документ ЕСТЬ NULL
	 |	И АктОРасхождениях.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	 |	И НЕ АктОРасхождениях.ПометкаУдаления";

	 Результат = СтрЗаменить(Результат, "&ВидПакетаID",	"""" + ВидПакетаID + """");
	
	 Результат = ТекстЗапроса_СкорректированныеСвязиДляОтправленныхДокументов(Результат, ОписаниеВидаПакета);
	
	 Возврат Результат;
	
 КонецФункции